{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}
{%- from "moj/components/banner/macro.njk" import mojBanner -%}

{% set jurors = approvalData[currentTab] %}

{% if jurors | length > 0 %}
  <div class="flex mod-flex mod-gap-x-4"></div>
  
  <form action="{{ processUrl }}" method="post" id="approveExpensesForm" >

    {{ govukButton({
      type: "submit",
      text: "Approve"
    }) }}

    <div class="govuk-body govuk-!-margin-bottom-0"> <span id="checkedJurors"></span> of <span id="totalJurors"></span> selected</div>

    <table class="govuk-table" data-module="moj-sortable-table" data-multi-select-checkbox="#select-all" id="jurors" name="jurors">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header" >
            <div class="govuk-checkboxes__item govuk-checkboxes--small moj-multi-select__checkbox" onclick="selectAll()">
              <input type="checkbox" class="govuk-checkboxes__input select-check juror-select-check" id="selectAllCheckbox" name="selectAllCheckbox"/>
              <label class="govuk-label govuk-checkboxes__label">
                <span class="govuk-visually-hidden">Select All</span>
              </label>
            </div>
          </th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="ascending">Juror number</th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="none">Pool number</th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="none">First name</th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="none">Last name</th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="none">Amount due</th>
          <th scope="col" class="govuk-table__header jd-middle-align" aria-sort="none">Status</th>
          <th scope="col" class="govuk-table__header jd-middle-align"></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
    
      {% for juror in jurors %}

        {% set tagClass = "govuk-tag--blue"%}
        {% if juror.status === "For reapproval" %}
          {% set tagClass = "govuk-tag--red"%}
        {% endif %}

        <tr class="govuk-table__row govuk-table__row--selected">
          <td class="govuk-table__cell">
            <div class="govuk-checkboxes__item govuk-checkboxes--small moj-multi-select__checkbox" onclick="checkSet()">
              <input type="checkbox" class="govuk-checkboxes__input select-check juror-select-check" id="select-{{ juror.jurorNumber }}" name="selectedJurors" value="{{ juror.jurorNumber }}">
              <label class="govuk-label govuk-checkboxes__label" for="select-{{ juror.login }}">
                <span class="govuk-visually-hidden">Select {{ juror.jurorNumber }}</span>
              </label>
            </div>
          </td>
          <td id="{{juror.jurorNumber}}-jurorNumber" class="govuk-table__cell jd-middle-align">{{ juror.jurorNumber }}</td>
          <td id="{{juror.jurorNumber}}-poolNumber" class="govuk-table__cell jd-middle-align">{{ juror.poolNumber }}</td>
          <td id="{{juror.jurorNumber}}-firstName" class="govuk-table__cell jd-middle-align">{{ juror.firstName  | capitalize }}</td>
          <td id="{{juror.jurorNumber}}-lastName" class="govuk-table__cell jd-middle-align">{{ juror.lastName  | capitalize }}</td>
          <td id="{{juror.jurorNumber}}-total" class="govuk-table__cell jd-middle-align govuk-!-font-weight-bold">{{ juror.total | capitalize }}</td>
          <td id="{{juror.jurorNumber}}-status" class="govuk-table__cell jd-middle-align">
            {{govukTag({
              text: juror.status,
              classes: tagClass
            })}}
          </td>
          <td id="{{juror.jurorNumber}}-viewExpenses" class="govuk-table__cell jd-middle-align"><a href="{{url('juror-management.approve-expenses.view-expenses.get', {jurorNumber: juror.jurorNumber})}}">View expenses</a></td>
        </tr>

      {% endfor %}

      </tbody>
    </table>

    <input type="hidden" name="_csrf" id="csrfToken" value="{{ csrftoken }}">
  </form>
  <script>
    let allChecked = false;
    let chkbxs = document.getElementsByName('selectedJurors');
    document.getElementById("totalJurors").innerHTML = chkbxs.length;
    document.getElementById("checkedJurors").innerHTML = 0;

    function selectAll() {
      if (allChecked) {
        allChecked = false;
        for(var i = 0; i < chkbxs.length; i++){
          if (chkbxs[i].type=='checkbox')
          chkbxs[i].checked = false;   
        }
        document.getElementById("checkedJurors").innerHTML = $('input:checkbox:checked').length;
      } else {
        allChecked = true;
        for(var i = 0; i <chkbxs.length; i++){
          if (chkbxs[i].type=='checkbox')
          chkbxs[i].checked = true;  
        }
        document.getElementById("checkedJurors").innerHTML = $('input:checkbox:checked').length - 1;
      }
      
    };

    function checkSet() {
      document.getElementById("checkedJurors").innerHTML = $('input:checkbox:checked').length;
      if (chkbxs.length > document.getElementsByName('selectedJurors:checked').length) {
        document.getElementsByName('selectAllCheckbox')[0].checked = false;
        allChecked = false;
      }
    }
  </script>

  {% else %}

    <p class="govuk-body">There are no expenses to approve.</p>

{% endif %}
