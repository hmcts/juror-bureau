{% from "./expenses-table-macros.njk" import consolidatedExpensesTable %}
{% from "./expenses-table-macros.njk" import attendanceType %}
{% from "./expenses-table-macros.njk" import rowCheckbox %}

<div class="govuk-grid-row">
  {% if expenseData.expenseDetails.length === 0 %}

    <div class="govuk-grid-column-full govuk-body">
      There are no draft expenses.
    </div>

  {% else %}

    {% set headingsHtml %}
      <th scope="col" class="govuk-table__header">Date</th>
      <th scope="col" class="govuk-table__header">Attendance</th>
      <th scope="col" class="govuk-table__header">Loss of earnings</th>
      <th scope="col" class="govuk-table__header">Extra care</th>
      <th scope="col" class="govuk-table__header">Other</th>
      <th scope="col" class="govuk-table__header">P. transport</th>
      <th scope="col" class="govuk-table__header">Taxi</th>
      <th scope="col" class="govuk-table__header">Motorcycle</th>
      <th scope="col" class="govuk-table__header">Car</th>
      <th scope="col" class="govuk-table__header">Bicycle</th>
      <th scope="col" class="govuk-table__header">Parking</th>
      <th scope="col" class="govuk-table__header">Food and drink</th>
      <th scope="col" class="govuk-table__header">(Smartcard)</th>
      <th scope="col" class="govuk-table__header">Method</th>
      <th scope="col" class="govuk-table__header mod-highlight-table-data__grey mod-center-table-data">Total</th>
    {% endset %}

    {% set rowsHtml %}
      {% for expense in expenseData.expenseDetails %}

        <tr class="govuk-table__row">
          {{ rowCheckbox({ attendanceDate: expense.attendanceDate }) }}
          <td class="govuk-table__cell">
            <a href="{{ enterExpensesUrl }}?date={{ expense.attendanceDate }}&page={{ loop.index }}" class="govuk-body govuk-link" id="expenseDateLink">
              {{ expense.attendanceDate | dateFilter("YYYY-MM-DD", "ddd DD MMM YYYY") }}
            </a>
          </td>
          <td class="govuk-table__cell">{{ attendanceType({ attendance: expense.attendanceType }) }}</td>
          <td class="govuk-table__cell">£{{ expense.lossOfEarnings | toFixed(2) }}</td>
          <td class="govuk-table__cell">£{{ expense.extraCare | toFixed(2) }}</td>
          <td class="govuk-table__cell">£{{ expense.other | toFixed(2) }}</td>
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.publicTransport | toFixed(2) }}
            {% endif %}
          </td>
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.taxi | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.motorcycle | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.car | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.bicycle | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.parking | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              £{{ expense.foodAndDrink | toFixed(2) }}</td>
            {% endif %}
          <td class="govuk-table__cell">
            {% if expense.attendanceType === "NON_ATTENDANCE" or expense.attendanceType === "NON_ATTENDANCE_LONG_TRIAL" %}
              -
            {% else %}
              (£{{ expense.smartCard | toFixed(2) }})</td>
            {% endif %}
          <td class="govuk-table__cell">{{ expense.paymentMethod }}</td>
          <td class="govuk-table__cell mod-highlight-table-data__grey mod-center-table-data"><b>£{{ expense.total | toFixed(2) }}</b></td>
        </tr>

      {% endfor %}

      <tr class="govuk-table__row mod-highlight-table-row__grey">
        <td class="govuk-table__cell"></td>
        <td class="govuk-table__cell"><b>Totals</b></td>
        <td class="govuk-table__cell"><b>{{ expenseData.total.totalDays }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.lossOfEarnings | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.extraCare | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.other | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.publicTransport | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.taxi | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.motorcycle | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.car | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.bicycle | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.parking | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>£{{ expenseData.total.foodAndDrink | toFixed(2) }}</b></td>
        <td class="govuk-table__cell"><b>(£{{ expenseData.total.smartCard | toFixed(2) }})</b></td>
        <td class="govuk-table__cell"></td>
        <td class="govuk-table__cell mod-center-table-data"><b>£{{ expenseData.total.total | toFixed(2) }}</b></td>
      </tr>
    {% endset %}
    
    {{ consolidatedExpensesTable({
      headings: headingsHtml,
      rows: rowsHtml,
      totalExpenses: totalExpenses,
      totalCheckedExpenses: 0,
      errors: errors
    }) }}

  {% endif %}
</div>