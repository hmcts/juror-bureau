{% extends "layouts/default.njk" %}

{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}

{% from "custom-components/date-picker/macro.njk" import datePicker %}
{% from "custom-components/autocomplete/macro.njk" import modAutocomplete %}

{% from "includes/csrf.njk" import csrfProtection %}

{% set currentApp = "Messaging" %}

{% block page_title %}{{ serviceName }} - Messaging - export contact details{% endblock %}
{% block page_identifier %}messaging - export contact details{% endblock %}

{# juror number infos #}
{% set jurorNumberError = undefined %}
{% if errors.items["jurorNumber"] %}
  {% set jurorNumberError = { "text": errors.items["jurorNumber"][0].details } %}
{% endif %}

{% set byJurorHtml %}
  {{ govukInput({
    label: {
      text: "Enter juror name, number or postcode"
    },
    id: "jurorNumber",
    name: "jurorNumber",
    errorMessage: jurorNumberError
  }) }}
{% endset %}

{# pool number infos #}
{% set poolNumberError = undefined %}
{% if errors.items["poolNumber"] %}
  {% set poolNumberError = { "text": errors.items["poolNumber"][0].details } %}
{% endif %}

{% set byPoolHtml %}
  {{ govukInput({
    label: {
      text: "Enter pool number"
    },
    classes: "govuk-input--width-10",
    id: "poolNumber",
    name: "poolNumber",
    errorMessage: poolNumberError
  }) }}
{% endset %}

{# court name infos #}
{% set courtNameError = undefined %}
{% if errors.items["courtName"] %}
  {% set courtNameError = { "text": errors.items["courtName"][0].details } %}
{% endif %}

{% set byCourtHtml %}
  {{ modAutocomplete({
    label: {
      text: "Enter court name"
    },
    name: "courtName",
    id: "courtName",
    data: courts,
    errorMessage: courtNameError
  }) }}
{% endset %}

{% set byDeferredToDateHtml %}
  {{ datePicker({
    id: "deferredTo",
    label: {
      text: "Enter a deferral date"
    },
    hint: "Use dd/mm/yyyy format. For example, 31/01/2023."
  }) }}
  {# dateValue: "25/12/2023",
  dateMin: "25/12/2022",
  dateMax: "25/12/2024",
  dateError: "An error message." #}
{% endset %}

{# radios error #}
{% set searchByError = undefined %}
{% if errors.items["searchBy"] %}
  {% set searchByError = { "text": errors.items["searchBy"][0].details } %}
{% endif %}

{% block content %}

  {% include "includes/errors.njk" %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <span class="govuk-caption-xl">Export contact details</span>
      <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">Find contact details</h1>
    </div>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">

      <form id="findContactDetailsForm" method="post">
        {{ govukRadios({
          name: "searchBy",
          fieldset: {
            legend: {
              text: "Search by",
              classes: "govuk-fieldset__legend--m"
            }
          },
          items: [
            {
              value: "juror",
              text: "Juror",
              conditional: { html: byJurorHtml },
              checked: jurorNumberError !== undefined
            },
            {
              value: "pool",
              text: "Pool",
              conditional: { html: byPoolHtml },
              checked: poolNumberError !== undefined
            },
            {
              value: "court",
              text: "Deferrals in a specific court",
              conditional: { html: byCourtHtml },
              checked: courtNameError !== undefined
            },
            {
              value: "dateDeferredTo",
              text: "Date deferred to",
              conditional: { html: byDeferredToDateHtml }
            }
          ],
          errorMessage: searchByError
        }) }}

        {{ csrfProtection(csrftoken) }}

        <div class="govuk-button-group">
          {{ govukButton({
            text: "Continue",
            attributes: {
              id: "continueButton"
            }
          }) }}
        
          {# I don't think this screen needs a cancel link because there is nothing to cancel and go back to #}
          {# <a class="govuk-link" href="#">Cancel</a> #}
        </div>

      </form>

    </div>
  </div>
{% endblock %}

{% block body_end %}
  {{ super() }}

  <script type="text/javascript" src="{{ assetPath }}js/ds-datepicker.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      const datePickers = []
        .slice
        .call(document.querySelectorAll('[data-module="ds-datepicker"]'));
      datePickers.forEach(datePicker => new DSDatePicker(datePicker, {imagePath: '{{ assetPath }}assets/images/icons/'}).init());
    });
  </script>
{% endblock %}